<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kochi Metro Rail Limited</title>
<link rel="icon" type="x-icon" href="images/STK-20250921-WA0001.webp">
<style>
  body {font-family: Arial, sans-serif; margin:0; background:#f0f3f5; color:#1a1a1a;}
  header {background:#1976D2; color:white; padding:1rem; text-align:center; font-weight:700;}
  main {display:flex; gap:15px; padding:15px;}
  .card {background:white; border-radius:10px; padding:16px; flex:1; box-shadow:0 2px 8px rgba(0,0,0,0.1);}
  h2 {margin-top:0; color:#1976D2;}
  table {width:100%; border-collapse:collapse; margin-top:12px;}
  th, td {padding:8px; border:1px solid #ddd; text-align:center;}
  th {background:#f1f3f4; color:#333;}
  select, input {padding:6px; border-radius:6px; border:1px solid #ccc;}
  button {padding:6px 12px; border:none; border-radius:6px; cursor:pointer; background:#1976D2; color:white;}
  .bay-grid {display:grid; grid-template-columns:repeat(6,1fr); gap:8px; margin-top:12px;}
  .bay {padding:12px; border-radius:6px; border:1px dashed #ccc; text-align:center; font-weight:700;}
  .bay.occupied {background:#ffe0e0; border:1px solid #f5c2c2; color:#a00000;}
  .bay.available {background:#e8f5e9; border:1px solid #c8e6c9; color:#2e7d32;}
  .status-pass {color:#2e7d32; font-weight:700;}
  .status-fail {color:#a00000; font-weight:700;}
</style>
</head>
<body>

<header>
  KMRL Inspection Management
</header>

<main>
  <div class="card">
    <h2>Trains Assigned for Inspection</h2>
    <table id="inspectionTable">
      <thead>
        <tr>
          <th>Train ID</th>
          <th>Assigned Bay</th>
          <th>Safety Check</th>
          <th>Routine Check</th>
          <th>Inspection Result</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="card">
    <h2>Inspection Bays</h2>
    <div class="bay-grid" id="inspectionBays"></div>
  </div>
</main>

<script>
  const inspectionTrains = [
    {id:'T02', bay:null, safety:'Pending', routine:'Pending', result:'Pending'},
    {id:'T05', bay:null, safety:'Pending', routine:'Pending', result:'Pending'},
    {id:'T11', bay:null, safety:'Pending', routine:'Pending', result:'Pending'},
    {id:'T18', bay:null, safety:'Pending', routine:'Pending', result:'Pending'},
  ];

  const bays = Array(12).fill(null);

  function renderTable(){
    const tbody = document.querySelector('#inspectionTable tbody');
    tbody.innerHTML = '';
    inspectionTrains.forEach((t,i)=>{
      const baySelect = `<select onchange="assignBay(${i}, this.value)">
        <option value="">Select Bay</option>
        ${bays.map((b,idx)=>`<option value="${idx}" ${t.bay===idx?'selected':''}>Bay ${idx+1} ${b?'(Occupied)':''}</option>`).join('')}
      </select>`;
      const safetyOptions = `<select onchange="updateSafety(${i}, this.value)">
        <option value="Pending" ${t.safety==='Pending'?'selected':''}>Pending</option>
        <option value="Pass" ${t.safety==='Pass'?'selected':''}>Pass</option>
        <option value="Fail" ${t.safety==='Fail'?'selected':''}>Fail</option>
      </select>`;
      const routineOptions = `<select onchange="updateRoutine(${i}, this.value)">
        <option value="Pending" ${t.routine==='Pending'?'selected':''}>Pending</option>
        <option value="Pass" ${t.routine==='Pass'?'selected':''}>Pass</option>
        <option value="Fail" ${t.routine==='Fail'?'selected':''}>Fail</option>
      </select>`;
      const result = t.result==='Pending' ? '-' : t.result==='Pass' ? '<span class="status-pass">Pass</span>' : '<span class="status-fail">Fail</span>';

      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${t.id}</td>
                      <td>${baySelect}</td>
                      <td>${safetyOptions}</td>
                      <td>${routineOptions}</td>
                      <td>${result}</td>
                      <td><button onclick="finalize(${i})">Finalize</button></td>`;
      tbody.appendChild(tr);
    });
  }

  function renderBays(){
    const grid = document.getElementById('inspectionBays');
    grid.innerHTML='';
    bays.forEach((b,i)=>{
      const div = document.createElement('div');
      div.className = 'bay ' + (b!==null?'occupied':'available');
      div.textContent = `Bay ${i+1}` + (b!==null?` â€” ${b}`:'');
      grid.appendChild(div);
    });
  }

  function assignBay(trainIndex, bayIndex){
    bayIndex = bayIndex === '' ? null : parseInt(bayIndex);
    const prevBay = inspectionTrains[trainIndex].bay;
    if(prevBay!==null) bays[prevBay]=null;
    if(bayIndex!==null && bays[bayIndex]===null){
      bays[bayIndex] = inspectionTrains[trainIndex].id;
      inspectionTrains[trainIndex].bay = bayIndex;
    } else {
      inspectionTrains[trainIndex].bay = null;
    }
    renderTable();
    renderBays();
  }

  function updateSafety(trainIndex, value){
    inspectionTrains[trainIndex].safety = value;
    renderTable();
  }

  function updateRoutine(trainIndex, value){
    inspectionTrains[trainIndex].routine = value;
    renderTable();
  }

  function finalize(trainIndex){
    const t = inspectionTrains[trainIndex];
    if(t.safety==='Pending' || t.routine==='Pending'){
      alert('Complete all inspections before finalizing!');
      return;
    }
    t.result = (t.safety==='Pass' && t.routine==='Pass') ? 'Pass' : 'Fail';
    alert(`${t.id} inspection finalized: ${t.result}`);
    renderTable();
  }

  renderTable();
  renderBays();
</script>

</body>
</html>
